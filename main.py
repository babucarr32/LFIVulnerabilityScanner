from bs4 import BeautifulSoup
import requests


def LFIVulScanner(*args):
    vuls = []
    URL = args[0]
    cookies = {args[1]: args[2]}
    explodedDir = []
    URLContainer = []

    html = requests.get(URL, cookies=cookies)
    soup = BeautifulSoup(html.text, 'lxml')
    dirs = soup.findAll('a')

    for dir in dirs:
        html = requests.get(URL + "/" + dir['href'], timeout=.75)  # exploding the scan
        soup = BeautifulSoup(html.text, 'lxml')
        dirs = soup.findAll('a')
        for i in dirs:  # append exploded dirs
            explodedDir.append(URL + "/" + i['href'])
        if "?page=" in dir['href']:
            vuls.append(dir['href'])
    # print(explodedDir)

    newExpDir = []
    # print(explodedDir)
    for i in range(int(args[3])): # determine the amount of urls  to scan
        for expDir in explodedDir:
            print(expDir)
            html = requests.get(expDir, timeout=.75)
            soup = BeautifulSoup(html.text, 'lxml')
            dirs = soup.findAll('a')
            for i in dirs:  # append exploded dirs
                newExpDir.append(URL + "/" +i['href'])
        URLContainer.append(explodedDir)
        URLContainer.append(newExpDir)
        explodedDir = newExpDir
        # print(explodedDir)
        newExpDir = []
    #
    # print('----------------------')
    # for i in URLContainer:
    #     print(i)
    # if vuls != "":
    #     if len(vuls) == 1:
    #         print(f"{len(vuls)} LFI Vulnerability found!!!")
    #         print("----------------------------------------")
    #     else:
    #         print(f"{len(vuls)} LFI Vulnerabilities found!!!")
    #         print("----------------------------------------")
    #     for vul in vuls:
    #         print(URL + "/" + vul)
    # else:
    #     print(f"{len(vuls)} LFI Vulnerabilities found!!!")
    #     print("----------------------------------------")


if __name__ == "__main__":
    Command = input("Enter Command: ")
    CommandSplitter = Command.split()  # split the data
    CommandArgs = []
    for i in CommandSplitter:
        CommandArgs.append(i)
    LFIVulScanner(*CommandArgs)
# http://10.1.1.122/dvwa
# http://10.1.1.122/dvwa/security.php PHPSESSID e52cc2cc4c1c21adeccd46533c78fa82 1
